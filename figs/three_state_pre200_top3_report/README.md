# 三状态 pre200 报告（Top 神经元 & 预触摸窗口）

本文件夹由脚本 `three_state_top3_and_pretouch_plots.py` 自动生成。

---

## 一、状态定义

- **状态 0（State 0）**：重聚前 200 秒的独处期  
  （只有实验鼠本身，没有另一只鼠，更没有社交触摸）

- **状态 1（State 1）**：重聚之后，但当前不在任何社交触摸 bout 内  
  （另一只鼠已经在场，但当前没有接触）

- **状态 2（State 2）**：社交触摸期  
  （由 Excel 中 “社交开始 / 社交结束” 标注出的触摸时间段）

在构建三状态 GLM 之前：

- 对所有神经元的活动做 z-score，并进行轻微平滑；
- 以 1 s 为 bin 宽对时间进行分箱，得到每个 bin 的平均活动；
- 使用多项式 logistic 回归（multinomial GLM）拟合三类状态。

模型会为每一个状态得到一条权重向量 β：
- 某个神经元在某个状态上的 |β| 越大，说明它对**区分该状态**的贡献越强。

---

## 二、图像说明

### 1）`state0_top3_activity.png`

**State 0（重聚前独处期）** 的 Top 3 代表神经元  
（按 |β_state0| 从大到小排序）。

图中显示这 3 个神经元在整个扩展时间段上的活动轨迹：
- 横轴：相对重聚时间（秒）  
- 纵轴：z-score 后的神经元活动  
- 背景浅色阴影：**触摸期（State 2）**，用于参照

选中的神经元及对应权重：
- neuron 11：β_state0 = -0.4410  
- neuron 84：β_state0 = -0.4279  
- neuron 50：β_state0 = -0.4262  

这些细胞主要在**重聚前的独处阶段**表现出显著的状态相关性。

---

### 2）`state1_top3_activity.png`

**State 1（重聚后无触摸阶段）** 的 Top 3 代表神经元  
（按 |β_state1| 从大到小排序）。

同样是整个扩展时间段的活动轨迹：
- 横轴：相对重聚时间（秒）  
- 纵轴：z-score 后的神经元活动  
- 背景浅色阴影：**触摸期（State 2）**，用于参照

选中的神经元及对应权重：
- neuron 82：β_state1 = +1.0675  
- neuron 112：β_state1 = -1.0453  
- neuron 30：β_state1 = -0.9764  

这几颗细胞对 **“有对方在场但暂时没有触摸”** 这一状态的判别最具代表性，
其中正负号表示是“偏好该状态”还是“在该状态被抑制”。

---

### 3）`state2_top3_activity.png`

**State 2（社交触摸期）** 的 Top 3 代表神经元  
（按 |β_state2| 从大到小排序）。

同样展示扩展时间段内的活动轨迹：
- 横轴：相对重聚时间（秒）  
- 纵轴：z-score 后的神经元活动  
- 背景浅色阴影：**触摸期（State 2）**，用于参照

选中的神经元及对应权重：
- neuron 82：β_state2 = -1.1285  
- neuron 112：β_state2 = +1.0907  
- neuron 64：β_state2 = +0.9185  

可以看到：
- neuron 112 / 64 是典型的 **pro-touch（触摸正向编码）** 细胞；  
- neuron 82 在 state2 上为大负值，是典型的 **anti-touch / pro-no-touch** 方向。

---

### 4）`reunion_pretouch_timeline.png`

这是一张压缩版的时间轴示意图，用来展示扩展 epoch 内的三状态标签以及预触摸窗口。

- 横轴：相对重聚时间（秒）  
- 虚线竖线：每一次 **触摸开始**（Excel 中的 “社交开始” 时刻）  
- 浅色块：**预触摸窗口**，定义为每次触摸开始前的 **5 秒**

这张图帮助我们直观地看到：
- state1（无触摸）是如何在时间轴上多次转换为 state2（触摸）的；
- 预触摸 5 秒窗口在整体时间中的分布位置，方便后续分析
  “在触摸之前社交需求 / 神经活动是否存在 ramping”。

---

## 三、文件列表

- `three_state_glm_outputs.npz`  
  包含三状态 GLM 的权重、扩展 epoch 的神经活动、时间轴以及对应的状态标签等信息，
  用于复现本文件夹中的所有图像。

- `README.md`  
  即本说明文件。
