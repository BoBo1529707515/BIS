# 基于 Need_z(t) 的一维 HMM / AR 动力学分析

本文件夹由脚本 `社交需求_一维HMM_AR动态.py` 自动生成，用于在已经构造好的社交需求指数轨迹 Need_z(t) 上进行一维动力学建模。

## 一、数据来源

- Need_z(t) 来源于上一脚本 `社交需求指数_三态GLM.py`：
  - 先用三状态 GLM 得到 β_state0, β_state1, β_state2。
  - 定义“触摸 vs 无触摸”社交轴：w = β_state2 − β_state1。
  - 对每一帧群体活动 spikes(t) 做投影并 z-score：Need_z(t) = zscore(w^T · spikes(t))。

## 二、模型简介

1. **高斯(iid)模型**
   - 假设 Need_z(t) 独立同分布，来自一个 N(μ, σ²)。
   - 用整体均值和方差拟合，并计算对数似然 / AIC / BIC。

2. **AR(1) 模型**
   - 假设 Need_z(t) 连续时间有记忆：x_t = a · x_{t-1} + eps。
   - 用最小二乘估计 a 和残差方差，计算对数似然 / AIC / BIC。

3. **二维 GMM 模型**
   - 假设 Need_z(t) 的静态分布是两个高斯的混合（不考虑时间结构）。
   - 拟合两个高斯成分及混合权重，计算整体 log-likelihood / AIC / BIC。

4. **二维 Gaussian HMM 模型**
   - 假设存在两个隐状态 z_t ∈ {0,1}，每个状态下 Need_z(t) 服从不同的高斯分布。
   - 同时估计状态转移矩阵和各状态的均值/方差，得到最可能的状态序列 z_t。
   - 这一步体现了“状态切换”的时间结构。

5. **HMM 状态内 AR(1)（近似 HMM-AR）**
   - 在 HMM 解码出的 z_t 上，分别在每个隐状态内估计 AR(1) 系数 a_s。
   - 如果某个状态的 a_s 接近 0，表示该状态下 Need_z 变化更像白噪声；
   - 如果 a_s 较大（接近 1），说明该状态下 Need_z 有较强的持续性 / ramping。

## 三、模型比较结果（logL / AIC / BIC）

以下为在完整 Need_z(t) 上拟合得到的指标（数值仅供该数据集内部比较）：

- **Gaussian(iid)**:
  - log-likelihood = -12417.13
  - AIC = 24838.26
  - BIC = 24852.42
  - mu: 0.000
  - var: 1.000

- **AR(1)**:
  - log-likelihood = 11849.32
  - AIC = -23694.64
  - BIC = -23680.49
  - a: 0.998
  - var_eps: 0.004

- **GMM(2 comp)**:
  - log-likelihood = -11419.84
  - AIC = 22849.69
  - BIC = 22885.07
  - means: -0.271, 2.011

- **HMM-Gaussian(2)**:
  - log-likelihood = -8409.53
  - AIC = 16833.06
  - BIC = 16882.59
  - means: -0.331, 1.803
  - transmat: [[0.999 0.001]
 [0.006 0.994]]


一般来说，AIC/BIC 更小的模型说明对数据的解释更好（同时惩罚参数数量）。
若 HMM 或 HMM+AR 状态内的 ACF 明显高于高斯/简单 AR 模型，则支持“存在隐状态切换 + ramping”的动力学结构。

## 四、图像说明

### 1）HMM_need_timecourse_states.png
Need_z(t) 随时间变化，并用颜色区分 HMM-Gaussian 推断出的两个隐状态：
- 蓝色点：隐状态 0；
- 橙色点：隐状态 1；
可以直观看出哪些时间段处于高/低需求状态，以及状态切换大致发生在何处。

### 2）HMM_state_need_hist.png
HMM 每个隐状态下 Need_z 的静态分布：
- 若两个直方图中心相差较大，说明两个状态在平均需求水平上明显不同（例如：低 vs 高 Need）；
- 若一个状态的分布更宽，可能代表该状态内部的需求波动更大。

### 3）Need_ACF_overall_and_states.png
Need_z 的自相关函数（ACF）：
- 粗线：整体 Need_z 的自相关；
- 虚线：在各个 HMM 状态内分别计算的自相关（若样本足够）。
- 若某个状态的 ACF 在较长滞后时间内仍然偏高，说明该状态具有较强的“记忆”或 ramping 特性。

### 4）HMM_state_AR1_coeffs.png
HMM 每个隐状态内估计得到的 AR(1) 系数 a_s：
- a_s 越接近 1，表示该状态下需求信号变化更为缓慢、具有更强的持续性；
- a_s 接近 0，表示该状态下信号更接近白噪声。
- 若一个状态的 a_s 高、另一个低，可对照行为标签，将其解释为“ramping 高需求状态” vs “非 ramping 低需求状态”。

## 五、如何解释这些结果？

如果在该数据中观察到：
- HMM 模型相对于单一高斯或简单 AR 模型，具有更低的 AIC/BIC；
- HMM 中一个状态的均值明显更高（或更低），且该状态更常出现在某些行为阶段（如接近触摸、触摸期）；
- HMM 状态内的 AR(1) 系数显示：高需求状态 a_s 较大（更持续），低需求状态 a_s 较小；
那么可以自然地将这两个 HMM 状态解释为：
- **状态 0：低需求/非 ramping 状态**（例如，长时间无社交接触、或稳定的基线期）；
- **状态 1：高需求/ramping 状态**（例如，接近社交触摸开始前后的阶段）。

这与原论文中“动机维度上存在隐状态切换 + ramping 动力学”的结论是一致的，只是这里换成了基于三态 GLM 定义的社交需求指数 Need_z(t)。
