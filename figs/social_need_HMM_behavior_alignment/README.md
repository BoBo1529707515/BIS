# HMM 隐状态与行为的对齐分析

本文件夹由脚本 `社交需求_HMM状态_行为关系.py` 自动生成，用于分析：
1. 一维社交需求指数 Need_z(t) 上拟合得到的 HMM 隐状态，如何与三态行为标签 (0/1/2) 对齐；
2. 对齐“触摸开始”事件时，高需求 HMM 状态的概率随时间的变化；
3. 无触摸状态 (state1) 中，触摸前预窗口 vs 普通无触摸时间段中，高需求 HMM 状态的占比差异。

## 一、HMM 模型回顾（来自上一脚本）

- 在 Need_z(t) 上拟合了二维 Gaussian HMM：z_t ∈ {0,1}。
- 两个状态的均值（Need_z 的平均值）约为：
  - state 0: μ ≈ -0.331
  - state 1: μ ≈ 1.803
  通常可以自然地解释为“低需求状态”和“高需求状态”。
- 状态转移矩阵约为：
  [[0.99889648 0.00110352]
 [0.00601327 0.99398673]]
  表明两个状态本身都较为稳定（对角元素接近 1），
  提示这更像是两个长期内在模式，而不是瞬时抖动的噪声。

另外，在上一脚本里，我们还在每个 HMM 状态内估计了 AR(1) 系数和近似时间常数 τ，
通常会看到高需求状态具有更长的时间常数（更持续的 ramp/plateau）。
不同状态下 AR(1) 参数大致为：
- state 0: a ≈ 0.996, var_eps ≈ 0.004, n_pairs=7379, τ≈26.293 s
- state 1: a ≈ 0.999, var_eps ≈ 0.004, n_pairs=1355, τ≈179.658 s

## 二、图像说明

### 1）HMM_high_state_prob_by_behavior.png
**不同行为状态下，HMM 高需求状态 P(z=1) 的占比**：
- X 轴：三种行为状态（0:独处；1:无触摸；2:触摸）；
- Y 轴：在该行为状态下，Need_z(t) 属于 HMM 高需求状态 (z=1) 的概率；
- 每个柱子上标注了该行为状态下的样本数 n 以及 P(z=1) 的数值；
如果结果显示：
- 在触摸期 (state2) 下 P(z=1) 明显更高；
- 在独处期 (state0) 下 P(z=1) 相对较低；
- 在重聚无触摸期 (state1) 介于两者之间；
则支持“高需求 HMM 状态与更强的社交接触/触摸行为相对应”的解释。

### 2）P_z1_touch_onset_PSTH.png
**对齐触摸 onset 的 P(z=1) PSTH**：
- X 轴：相对触摸开始时间（秒，0 点为首次进入 state2 即触摸期）；
- Y 轴：在该相对时间点，高需求状态 z=1 的概率（跨所有触摸 bout 平均）；
- 左侧 5 秒被视为“预触摸窗口”；右侧 10 秒为触摸后期；
- 曲线为平均 P(z=1)，阴影为 ±SEM。
如果曲线显示：
- 在触摸开始前几秒，P(z=1) 已经开始上升；
- 在触摸期间 P(z=1) 保持在较高水平；
则说明 HMM 的高需求状态不仅反映触摸发生时刻本身，
也在触摸前就已经“预热”，可以作为社交需求/动机的一个内部状态变量。

### 3）P_z1_pretouch_vs_normal_in_state1.png
**无触摸状态中预触摸窗口 vs 普通无触摸时段的高需求状态概率**：
- 仅在行为标签 state1（重聚无触摸）中取样；
- 将触摸 onset 前 5 s 内定义为“预触摸窗口”；
- 其他 state1 时间点定义为“普通无触摸时段”；
- 对比这两类时间点中 P(z=1) 的差异。
如果观察到：
- 预触摸窗口中 P(z=1) 显著高于普通无触摸时间段；
则可以说：在行为上看起来同为“无触摸”的状态1内部，
已经存在一个“隐性分裂”：一部分时间是低需求状态，一部分时间是即将进入触摸的高需求状态。

## 三、小结

结合一维 Need_z(t) 的 HMM 拟合和本脚本的行为对齐分析，可以得到如下图景：

1. 在社交需求轴 Need_z(t) 上存在两个稳定的隐状态：低需求状态 (z=0) 和高需求状态 (z=1)。
2. 高需求状态在触摸期（行为 state2）内占比显著提高，且在触摸开始前的预窗口中概率也提前上升。
3. 即便在同为“无触摸”的行为状态1内部，高需求状态也更偏向于那些即将进入触摸的时间段。

因此，HMM 的高需求状态可以自然地解释为一种“内部社交需求/动机状态”，
它在时间上以 ramping/plateau 的方式变化，并通过切换到高需求状态，
提高未来一段时间内发生社交触摸行为的概率，而不是瞬时触发行为。
这与 Xie et al. (2025) 论文中提出的“switching ramping dynamics 驱动自发行为”的框架是平行的，只是这里换成了社交重聚/触摸场景。
